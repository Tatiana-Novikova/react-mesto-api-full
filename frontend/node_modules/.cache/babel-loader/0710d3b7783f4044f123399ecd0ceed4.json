{"ast":null,"code":"import _toConsumableArray from\"/Users/tatananovikova/Desktop/praktikum/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/tatananovikova/Desktop/praktikum/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{Switch,Route,Redirect,useHistory}from'react-router-dom';import ProtectedRoute from'./ProtectedRoute';import api from'../utils/api.js';import Login from'./Login.js';import Register from'./Register.js';import Header from'./Header.js';import Main from'./Main.js';import EditAvatarPopup from'./EditAvatarPopup.js';import EditProfilePopup from'./EditProfilePopup.js';import AddPlacePopup from'./AddPlacePopup.js';import DeletePlacePopup from'./DeletePlacePopup.js';import ImagePopup from'./ImagePopup.js';import Footer from'./Footer.js';import*as auth from'../auth';import{CurrentUserContext}from'./../contexts/CurrentUserContext.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),loggedIn=_React$useState2[0],setLoggedIn=_React$useState2[1];// const [email, setEmail] = React.useState('');\nvar _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditAvatarPopupOpened=_React$useState4[0],setIsEditAvatarPopupOpened=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditProfilePopupOpened=_React$useState6[0],setIsEditProfilePopupOpened=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isAddCardPopupOpened=_React$useState8[0],setIsAddCardPopupOpened=_React$useState8[1];var _React$useState9=React.useState({}),_React$useState10=_slicedToArray(_React$useState9,2),selectedCard=_React$useState10[0],setSelectedCard=_React$useState10[1];var _React$useState11=React.useState(null),_React$useState12=_slicedToArray(_React$useState11,2),cardToDelete=_React$useState12[0],setCardToDelete=_React$useState12[1];var _React$useState13=React.useState({}),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),cards=_React$useState16[0],setCards=_React$useState16[1];var componentDidMount=function componentDidMount(){handleTokenCheck();};var handleTokenCheck=function handleTokenCheck(){if(localStorage.getItem('jwt')){var jwt=localStorage.getItem('jwt');auth.checkToken(jwt).then(function(res){if(res){setLoggedIn(true);}});}};var history=useHistory();// function signOut(){\n//   localStorage.removeItem('jwt');\n//   history.push('/sign-in');\n// }\nfunction handleLogin(){setLoggedIn(true);}function handleEditAvatarClick(){setIsEditAvatarPopupOpened(true);}function handleEditProfileClick(){setIsEditProfilePopupOpened(true);}function handleAddCardClick(){setIsAddCardPopupOpened(true);}function handleCardClick(card){setSelectedCard(card);}function handleDeleteCardClick(card){setCardToDelete(card);}function handleUpdateAvatar(avatar){api.updateAvatar(avatar).then(function(userData){setCurrentUser(userData);setIsEditAvatarPopupOpened(false);}).catch(function(error){return console.log(error);});}function handleEditProfile(user){api.updateUserInfo(user).then(function(userData){setCurrentUser(userData);setIsEditProfilePopupOpened(false);}).catch(function(error){return console.log(error);});}function handleAddPlaceSubmit(card){api.addNewCard(card).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));setIsAddCardPopupOpened(false);});}function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card._id,isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(error){return console.log(error);});}function handleDeletePlaceSubmit(card){api.deleteCard(card._id).then(function(newCard){setCards(function(cards){return cards.filter(function(c){return c._id!==card._id;});});setCardToDelete(null);}).catch(function(error){return console.log(error);});}function closeAllPopups(){setIsEditAvatarPopupOpened(false);setIsEditProfilePopupOpened(false);setIsAddCardPopupOpened(false);setCardToDelete(null);setSelectedCard(false);}function handleRegisterSubmit(email,password){auth.register(email,password).then(function(data){if(data){history.push('/sign-in');}else{console.log('ошибка');}}).catch(function(error){return console.log(error);});}function handleLoginSubmit(email,password){auth.authorize(email,password).then(function(data){if(data){setLoggedIn(true);history.push('/');console.log('успешно');}else{console.log('ошибка');}}).catch(function(error){return console.log(error);});}React.useEffect(function(){Promise.all([api.getUserInfo(),api.getInitialCards()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),userData=_ref2[0],cardData=_ref2[1];setCurrentUser(userData);setCards(cardData);}).catch(function(error){return console.log(error);});},[]);return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"page-container\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header// onSignOut={signOut}\n,{}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,cards:cards,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddCard:handleAddCardClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleDeleteCardClick}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegisterSubmit})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLoginSubmit,onSubmit:handleLogin})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/main\"}):/*#__PURE__*/_jsx(Redirect,{to:\"./sign-up\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpened,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpened,onClose:closeAllPopups,onEditProfile:handleEditProfile}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddCardPopupOpened,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(DeletePlacePopup,{isOpen:!!cardToDelete,onClose:closeAllPopups,onDeletePlace:handleDeletePlaceSubmit,card:cardToDelete}),/*#__PURE__*/_jsx(ImagePopup,{name:\"preview-card\",onClose:closeAllPopups,card:selectedCard})]})})});}export default App;","map":{"version":3,"sources":["/Users/tatananovikova/Desktop/praktikum/react-mesto-auth/src/components/App.js"],"names":["React","Switch","Route","Redirect","useHistory","ProtectedRoute","api","Login","Register","Header","Main","EditAvatarPopup","EditProfilePopup","AddPlacePopup","DeletePlacePopup","ImagePopup","Footer","auth","CurrentUserContext","App","useState","loggedIn","setLoggedIn","isEditAvatarPopupOpened","setIsEditAvatarPopupOpened","isEditProfilePopupOpened","setIsEditProfilePopupOpened","isAddCardPopupOpened","setIsAddCardPopupOpened","selectedCard","setSelectedCard","cardToDelete","setCardToDelete","currentUser","setCurrentUser","cards","setCards","componentDidMount","handleTokenCheck","localStorage","getItem","jwt","checkToken","then","res","history","handleLogin","handleEditAvatarClick","handleEditProfileClick","handleAddCardClick","handleCardClick","card","handleDeleteCardClick","handleUpdateAvatar","avatar","updateAvatar","userData","catch","error","console","log","handleEditProfile","user","updateUserInfo","handleAddPlaceSubmit","addNewCard","newCard","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","state","map","c","handleDeletePlaceSubmit","deleteCard","filter","closeAllPopups","handleRegisterSubmit","email","password","register","data","push","handleLoginSubmit","authorize","useEffect","Promise","all","getUserInfo","getInitialCards","cardData"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Switch, Route, Redirect, useHistory } from 'react-router-dom';\nimport ProtectedRoute from './ProtectedRoute';\n\nimport api from '../utils/api.js';\nimport Login from './Login.js';\nimport Register from './Register.js';\nimport Header from './Header.js';\nimport Main from './Main.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport DeletePlacePopup from './DeletePlacePopup.js';\nimport ImagePopup from './ImagePopup.js';\nimport Footer from './Footer.js';\n\nimport * as auth from '../auth';\n\nimport { CurrentUserContext } from './../contexts/CurrentUserContext.js';\n\nfunction App() {\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  // const [email, setEmail] = React.useState('');\n  const [isEditAvatarPopupOpened, setIsEditAvatarPopupOpened] = React.useState(false);\n  const [isEditProfilePopupOpened, setIsEditProfilePopupOpened] = React.useState(false);\n  const [isAddCardPopupOpened, setIsAddCardPopupOpened] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [cardToDelete, setCardToDelete] = React.useState(null);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n\n  const componentDidMount = () => {\n    handleTokenCheck();\n  }\n\n  const handleTokenCheck = () => {\n    if(localStorage.getItem('jwt')) {\n      const jwt = localStorage.getItem('jwt');\n      auth.checkToken(jwt)\n      .then((res) => {\n        if (res) {\n          setLoggedIn(true);\n        }\n      })\n    }\n  }\n\n  const history = useHistory();\n\n  // function signOut(){\n  //   localStorage.removeItem('jwt');\n  //   history.push('/sign-in');\n  // }\n\n  function handleLogin() {\n    setLoggedIn(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpened(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpened(true);\n  }\n\n  function handleAddCardClick() {\n    setIsAddCardPopupOpened(true);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card)\n  }\n\n  function handleDeleteCardClick(card) {\n    setCardToDelete(card);\n  }\n\n  function handleUpdateAvatar(avatar) {\n    api.updateAvatar(avatar)\n    .then((userData) => {\n      setCurrentUser(userData);\n      setIsEditAvatarPopupOpened(false);\n    })\n    .catch((error) => console.log(error));\n  }\n\n  function handleEditProfile(user) {\n    api.updateUserInfo(user)\n    .then((userData) => {\n      setCurrentUser(userData);\n      setIsEditProfilePopupOpened(false);\n    })\n    .catch((error) => console.log(error));\n  }\n\n  function handleAddPlaceSubmit(card) {\n    api.addNewCard(card)\n    .then ((newCard) => {\n      setCards([newCard, ...cards]);\n      setIsAddCardPopupOpened(false);\n    })\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    api.changeLikeCardStatus(card._id, isLiked)\n      .then((newCard) => {\n        setCards((state) => \n          state.map((c) => \n            c._id === card._id ? newCard : c))\n      })\n      .catch((error) => console.log(error));\n  }\n\n  function handleDeletePlaceSubmit(card) {\n    api.deleteCard(card._id)\n      .then((newCard) => {\n        setCards((cards) => \n          cards.filter((c) => \n            c._id !== card._id))\n        setCardToDelete(null);\n      })\n      .catch((error) => console.log(error));\n  }\n\n  function closeAllPopups () {\n    setIsEditAvatarPopupOpened(false);\n    setIsEditProfilePopupOpened(false);\n    setIsAddCardPopupOpened(false);\n    setCardToDelete(null);\n    setSelectedCard(false);\n  }\n\n  function handleRegisterSubmit (email, password) {\n    auth.register(email, password)\n    .then((data) => {\n      if (data) {\n        history.push('/sign-in')\n      } \n      else {\n        console.log('ошибка')\n      }\n    })\n    .catch((error) => console.log(error));\n  }\n\n  function handleLoginSubmit (email, password) {\n    auth.authorize(email, password)\n    .then((data) => {\n      if (data) {\n        setLoggedIn(true)\n        history.push('/')\n        console.log('успешно')\n      } \n      else {\n        console.log('ошибка')\n      }\n    })\n    .catch((error) => console.log(error));\n  }\n\n\n  React.useEffect(() => {\n    Promise.all([ \n      api.getUserInfo(),\n      api.getInitialCards()\n      ])\n      .then(([userData, cardData]) => {\n        setCurrentUser(userData);\n        setCards(cardData);\n      })\n      .catch((error) => console.log(error));\n  }, []);\n\n  return (\n    <div className='page'>\n      <div className='page-container'>\n        <CurrentUserContext.Provider value={currentUser}>\n          <Header \n            // onSignOut={signOut}\n          />\n          <Switch>\n            <ProtectedRoute\n              exact path=\"/\"\n              loggedIn={loggedIn}\n              component={Main}\n              cards={cards}\n              onEditAvatar={handleEditAvatarClick}\n              onEditProfile={handleEditProfileClick}\n              onAddCard={handleAddCardClick}\n              onCardClick={handleCardClick}\n              onCardLike={handleCardLike}\n              onCardDelete={handleDeleteCardClick}\n              />\n            <Route path='/sign-up'>\n              <Register \n                onRegister={handleRegisterSubmit}\n              />\n            </Route>\n            <Route path='/sign-in'>\n              <Login \n                onLogin={handleLoginSubmit}\n                onSubmit={handleLogin}\n              />\n            </Route>\n            <Route exact path='/'>\n              {loggedIn ?  <Redirect to='/main' /> : <Redirect to='./sign-up' />}\n            </Route>\n          </Switch>\n          <Footer />\n          <EditAvatarPopup \n            isOpen={isEditAvatarPopupOpened} \n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar} \n          />\n          <EditProfilePopup \n            isOpen={isEditProfilePopupOpened} \n            onClose={closeAllPopups}\n            onEditProfile={handleEditProfile}\n          />\n          <AddPlacePopup \n            isOpen={isAddCardPopupOpened} \n            onClose={closeAllPopups}\n            onAddPlace={handleAddPlaceSubmit}\n          />\n          <DeletePlacePopup \n            isOpen={!!cardToDelete} \n            onClose={closeAllPopups}\n            onDeletePlace={handleDeletePlaceSubmit}\n            card={cardToDelete}\n          />\n          <ImagePopup\n            name='preview-card'\n            onClose={closeAllPopups}\n            card={selectedCard}\n          />\n        </CurrentUserContext.Provider>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import _toConsumableArray from\"/Users/tatananovikova/Desktop/praktikum/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/tatananovikova/Desktop/praktikum/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{Switch,Route,Redirect,useHistory}from'react-router-dom';import ProtectedRoute from'./ProtectedRoute';import api from'../utils/api.js';import Login from'./Login.js';import Register from'./Register.js';import Header from'./Header.js';import Main from'./Main.js';import EditAvatarPopup from'./EditAvatarPopup.js';import EditProfilePopup from'./EditProfilePopup.js';import AddPlacePopup from'./AddPlacePopup.js';import DeletePlacePopup from'./DeletePlacePopup.js';import ImagePopup from'./ImagePopup.js';import InfoTooltip from'./InfoTooltip.js';import Footer from'./Footer.js';import*as auth from'../auth';import{CurrentUserContext}from'./../contexts/CurrentUserContext.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),loggedIn=_React$useState2[0],setLoggedIn=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),registed=_React$useState4[0],setRegisted=_React$useState4[1];var _React$useState5=React.useState(''),_React$useState6=_slicedToArray(_React$useState5,2),email=_React$useState6[0],setEmail=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isInfoTooltipOpened=_React$useState8[0],setIsInfoTooltipOpened=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isEditAvatarPopupOpened=_React$useState10[0],setIsEditAvatarPopupOpened=_React$useState10[1];var _React$useState11=React.useState(false),_React$useState12=_slicedToArray(_React$useState11,2),isEditProfilePopupOpened=_React$useState12[0],setIsEditProfilePopupOpened=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),isAddCardPopupOpened=_React$useState14[0],setIsAddCardPopupOpened=_React$useState14[1];var _React$useState15=React.useState({}),_React$useState16=_slicedToArray(_React$useState15,2),selectedCard=_React$useState16[0],setSelectedCard=_React$useState16[1];var _React$useState17=React.useState(null),_React$useState18=_slicedToArray(_React$useState17,2),cardToDelete=_React$useState18[0],setCardToDelete=_React$useState18[1];var _React$useState19=React.useState({}),_React$useState20=_slicedToArray(_React$useState19,2),currentUser=_React$useState20[0],setCurrentUser=_React$useState20[1];var _React$useState21=React.useState([]),_React$useState22=_slicedToArray(_React$useState21,2),cards=_React$useState22[0],setCards=_React$useState22[1];var componentDidMount=function componentDidMount(){handleTokenCheck();};var handleTokenCheck=function handleTokenCheck(){if(localStorage.getItem('jwt')){var jwt=localStorage.getItem('jwt');auth.checkToken(jwt).then(function(res){if(res){setEmail(res.data.email);history.push('/');setLoggedIn(true);}}).catch(function(error){return console.log(error);});}};var history=useHistory();function signOut(){localStorage.removeItem('jwt');history.push('/sign-in');}function handleLogin(){setLoggedIn(true);}function handleRegister(){setRegisted(true);}function handleEditAvatarClick(){setIsEditAvatarPopupOpened(true);}function handleEditProfileClick(){setIsEditProfilePopupOpened(true);}function handleAddCardClick(){setIsAddCardPopupOpened(true);}function handleCardClick(card){setSelectedCard(card);}function handleDeleteCardClick(card){setCardToDelete(card);}function handleUpdateAvatar(avatar){api.updateAvatar(avatar).then(function(userData){setCurrentUser(userData);setIsEditAvatarPopupOpened(false);}).catch(function(error){return console.log(error);});}function handleEditProfile(user){api.updateUserInfo(user).then(function(userData){setCurrentUser(userData);setIsEditProfilePopupOpened(false);}).catch(function(error){return console.log(error);});}function handleAddPlaceSubmit(card){api.addNewCard(card).then(function(newCard){setCards([newCard].concat(_toConsumableArray(cards)));setIsAddCardPopupOpened(false);});}function handleCardLike(card){var isLiked=card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card._id,isLiked).then(function(newCard){setCards(function(state){return state.map(function(c){return c._id===card._id?newCard:c;});});}).catch(function(error){return console.log(error);});}function handleDeletePlaceSubmit(card){api.deleteCard(card._id).then(function(newCard){setCards(function(cards){return cards.filter(function(c){return c._id!==card._id;});});setCardToDelete(null);}).catch(function(error){return console.log(error);});}function closeAllPopups(){setIsEditAvatarPopupOpened(false);setIsEditProfilePopupOpened(false);setIsAddCardPopupOpened(false);setIsInfoTooltipOpened(false);setCardToDelete(null);setSelectedCard(false);}function handleRegisterSubmit(email,password){auth.register(email,password).then(function(data){if(data){history.push('/sign-in');setRegisted(true);setIsInfoTooltipOpened(true);}}).catch(function(error){setRegisted(false);setIsInfoTooltipOpened(true);console.log(error);});}function handleLoginSubmit(email,password){auth.authorize(email,password).then(function(data){if(data){setLoggedIn(true);history.push('/');}}).catch(function(error){return console.log(error);});}React.useEffect(function(){componentDidMount();});React.useEffect(function(){Promise.all([api.getUserInfo(),api.getInitialCards()]).then(function(_ref){var _ref2=_slicedToArray(_ref,2),userData=_ref2[0],cardData=_ref2[1];setCurrentUser(userData);setCards(cardData);}).catch(function(error){return console.log(error);});},[]);return/*#__PURE__*/_jsx(\"div\",{className:\"page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"page-container\",children:/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header// onSignOut={signOut}\n,{email:email}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,cards:cards,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddCard:handleAddCardClick,onCardClick:handleCardClick,onCardLike:handleCardLike,onCardDelete:handleDeleteCardClick}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{onRegister:handleRegisterSubmit,onSubmit:handleRegister})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{onLogin:handleLoginSubmit,onSubmit:handleLogin})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/main\"}):/*#__PURE__*/_jsx(Redirect,{to:\"./sign-up\"})})]}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpened,onClose:closeAllPopups,title:registed?'Вы успешно зарегистрировались!':'Что-то пошло не так! Попробуйте ещё раз.',imageSrc:registed?'../images/auth-success.svg':'../images/auth-fail.svg'}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpened,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpened,onClose:closeAllPopups,onEditProfile:handleEditProfile}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddCardPopupOpened,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(DeletePlacePopup,{isOpen:!!cardToDelete,onClose:closeAllPopups,onDeletePlace:handleDeletePlaceSubmit,card:cardToDelete}),/*#__PURE__*/_jsx(ImagePopup,{name:\"preview-card\",onClose:closeAllPopups,card:selectedCard})]})})});}export default App;","map":{"version":3,"sources":["/Users/tatananovikova/Desktop/praktikum/react-mesto-auth/src/components/App.js"],"names":["React","Switch","Route","Redirect","useHistory","ProtectedRoute","api","Login","Register","Header","Main","EditAvatarPopup","EditProfilePopup","AddPlacePopup","DeletePlacePopup","ImagePopup","InfoTooltip","Footer","auth","CurrentUserContext","App","useState","loggedIn","setLoggedIn","registed","setRegisted","email","setEmail","isInfoTooltipOpened","setIsInfoTooltipOpened","isEditAvatarPopupOpened","setIsEditAvatarPopupOpened","isEditProfilePopupOpened","setIsEditProfilePopupOpened","isAddCardPopupOpened","setIsAddCardPopupOpened","selectedCard","setSelectedCard","cardToDelete","setCardToDelete","currentUser","setCurrentUser","cards","setCards","componentDidMount","handleTokenCheck","localStorage","getItem","jwt","checkToken","then","res","data","history","push","catch","error","console","log","signOut","removeItem","handleLogin","handleRegister","handleEditAvatarClick","handleEditProfileClick","handleAddCardClick","handleCardClick","card","handleDeleteCardClick","handleUpdateAvatar","avatar","updateAvatar","userData","handleEditProfile","user","updateUserInfo","handleAddPlaceSubmit","addNewCard","newCard","handleCardLike","isLiked","likes","some","i","_id","changeLikeCardStatus","state","map","c","handleDeletePlaceSubmit","deleteCard","filter","closeAllPopups","handleRegisterSubmit","password","register","handleLoginSubmit","authorize","useEffect","Promise","all","getUserInfo","getInitialCards","cardData"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Switch, Route, Redirect, useHistory } from 'react-router-dom';\nimport ProtectedRoute from './ProtectedRoute';\n\nimport api from '../utils/api.js';\nimport Login from './Login.js';\nimport Register from './Register.js';\nimport Header from './Header.js';\nimport Main from './Main.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport DeletePlacePopup from './DeletePlacePopup.js';\nimport ImagePopup from './ImagePopup.js';\nimport InfoTooltip from './InfoTooltip.js';\nimport Footer from './Footer.js';\n\nimport * as auth from '../auth';\n\nimport { CurrentUserContext } from './../contexts/CurrentUserContext.js';\n\nfunction App() {\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const [registed, setRegisted] = React.useState(false);\n  const [email, setEmail] = React.useState('');\n  const [isInfoTooltipOpened, setIsInfoTooltipOpened] = React.useState(false);\n  const [isEditAvatarPopupOpened, setIsEditAvatarPopupOpened] = React.useState(false);\n  const [isEditProfilePopupOpened, setIsEditProfilePopupOpened] = React.useState(false);\n  const [isAddCardPopupOpened, setIsAddCardPopupOpened] = React.useState(false);\n  const [selectedCard, setSelectedCard] = React.useState({});\n  const [cardToDelete, setCardToDelete] = React.useState(null);\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [cards, setCards] = React.useState([]);\n  \n  const componentDidMount = () => {\n    handleTokenCheck();\n  }\n\n  const handleTokenCheck = () => {\n    if(localStorage.getItem('jwt')) {\n      const jwt = localStorage.getItem('jwt');\n      auth.checkToken(jwt)\n      .then((res) => {\n        if (res) {\n          setEmail(res.data.email);\n          history.push('/');\n          setLoggedIn(true);\n        }\n      })\n      .catch((error) => console.log(error));\n    }\n  }\n\n  const history = useHistory();\n\n  function signOut(){\n    localStorage.removeItem('jwt');\n    history.push('/sign-in');\n  }\n\n  function handleLogin() {\n    setLoggedIn(true);\n  }\n\n  function handleRegister() {\n    setRegisted(true);\n  }\n\n  function handleEditAvatarClick() {\n    setIsEditAvatarPopupOpened(true);\n  }\n\n  function handleEditProfileClick() {\n    setIsEditProfilePopupOpened(true);\n  }\n\n  function handleAddCardClick() {\n    setIsAddCardPopupOpened(true);\n  }\n\n  function handleCardClick(card) {\n    setSelectedCard(card)\n  }\n\n  function handleDeleteCardClick(card) {\n    setCardToDelete(card);\n  }\n\n  function handleUpdateAvatar(avatar) {\n    api.updateAvatar(avatar)\n    .then((userData) => {\n      setCurrentUser(userData);\n      setIsEditAvatarPopupOpened(false);\n    })\n    .catch((error) => console.log(error));\n  }\n\n  function handleEditProfile(user) {\n    api.updateUserInfo(user)\n    .then((userData) => {\n      setCurrentUser(userData);\n      setIsEditProfilePopupOpened(false);\n    })\n    .catch((error) => console.log(error));\n  }\n\n  function handleAddPlaceSubmit(card) {\n    api.addNewCard(card)\n    .then ((newCard) => {\n      setCards([newCard, ...cards]);\n      setIsAddCardPopupOpened(false);\n    })\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.likes.some(i => i._id === currentUser._id);\n    api.changeLikeCardStatus(card._id, isLiked)\n      .then((newCard) => {\n        setCards((state) => \n          state.map((c) => \n            c._id === card._id ? newCard : c))\n      })\n      .catch((error) => console.log(error));\n  }\n\n  function handleDeletePlaceSubmit(card) {\n    api.deleteCard(card._id)\n      .then((newCard) => {\n        setCards((cards) => \n          cards.filter((c) => \n            c._id !== card._id))\n        setCardToDelete(null);\n      })\n      .catch((error) => console.log(error));\n  }\n\n  function closeAllPopups () {\n    setIsEditAvatarPopupOpened(false);\n    setIsEditProfilePopupOpened(false);\n    setIsAddCardPopupOpened(false);\n    setIsInfoTooltipOpened(false);\n    setCardToDelete(null);\n    setSelectedCard(false);\n  }\n\n  function handleRegisterSubmit (email, password) {\n    auth.register(email, password)\n    .then((data) => {\n      if (data) {\n        history.push('/sign-in');\n        setRegisted(true);\n        setIsInfoTooltipOpened(true);\n      }\n    })\n    .catch((error) => {\n      setRegisted(false);\n      setIsInfoTooltipOpened(true);\n      console.log(error)\n    });\n  }\n\n  function handleLoginSubmit (email, password) {\n    auth.authorize(email, password)\n    .then((data) => {\n      if (data) {\n        setLoggedIn(true);\n        history.push('/');\n      }\n    })\n    .catch((error) => console.log(error));\n  }\n  \n  React.useEffect(() => {\n    componentDidMount();\n  })\n\n  React.useEffect(() => {\n    Promise.all([ \n      api.getUserInfo(),\n      api.getInitialCards()\n      ])\n      .then(([userData, cardData]) => {\n        setCurrentUser(userData);\n        setCards(cardData);\n      })\n      .catch((error) => console.log(error));\n  }, []);\n\n  return (\n      <div className='page'>\n      <div className='page-container'>\n        <CurrentUserContext.Provider value={currentUser}>\n          <Header \n            // onSignOut={signOut}\n            email={email}\n          />\n          <Switch>\n            <ProtectedRoute\n              exact path=\"/\"\n              loggedIn={loggedIn}\n              component={Main}\n              cards={cards}\n              onEditAvatar={handleEditAvatarClick}\n              onEditProfile={handleEditProfileClick}\n              onAddCard={handleAddCardClick}\n              onCardClick={handleCardClick}\n              onCardLike={handleCardLike}\n              onCardDelete={handleDeleteCardClick}\n              />\n            <Route path='/sign-up'>\n              <Register \n                onRegister={handleRegisterSubmit}\n                onSubmit={handleRegister}\n              />\n            </Route>\n            <Route path='/sign-in'>\n              <Login \n                onLogin={handleLoginSubmit}\n                onSubmit={handleLogin}\n              />\n            </Route>\n            <Route exact path='/'>\n              {loggedIn ?  \n                <Redirect to='/main' /> :\n                <Redirect to='./sign-up' />}\n            </Route>\n          </Switch>\n          <Footer />\n          <InfoTooltip\n            isOpen={isInfoTooltipOpened} \n            onClose={closeAllPopups}\n            title={ registed ? \n            'Вы успешно зарегистрировались!' : \n            'Что-то пошло не так! Попробуйте ещё раз.'\n            }\n            imageSrc={ registed ? \n            '../images/auth-success.svg' :\n            '../images/auth-fail.svg'}\n          />\n          <EditAvatarPopup \n            isOpen={isEditAvatarPopupOpened} \n            onClose={closeAllPopups}\n            onUpdateAvatar={handleUpdateAvatar} \n          />\n          <EditProfilePopup \n            isOpen={isEditProfilePopupOpened} \n            onClose={closeAllPopups}\n            onEditProfile={handleEditProfile}\n          />\n          <AddPlacePopup \n            isOpen={isAddCardPopupOpened} \n            onClose={closeAllPopups}\n            onAddPlace={handleAddPlaceSubmit}\n          />\n          <DeletePlacePopup \n            isOpen={!!cardToDelete} \n            onClose={closeAllPopups}\n            onDeletePlace={handleDeletePlaceSubmit}\n            card={cardToDelete}\n          />\n          <ImagePopup\n            name='preview-card'\n            onClose={closeAllPopups}\n            card={selectedCard}\n          />\n        </CurrentUserContext.Provider>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}